<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Examples | Roblox Lua Promise</title>
    <meta name="description" content="Promise implementation for Roblox">
    
    
    <link rel="preload" href="/roblox-lua-promise/assets/css/0.styles.c44d6f8c.css" as="style"><link rel="preload" href="/roblox-lua-promise/assets/js/app.11759dc5.js" as="script"><link rel="preload" href="/roblox-lua-promise/assets/js/6.4e8b591d.js" as="script"><link rel="preload" href="/roblox-lua-promise/assets/js/13.ceb2ce08.js" as="script"><link rel="preload" href="/roblox-lua-promise/assets/js/8.4fdf1a46.js" as="script"><link rel="prefetch" href="/roblox-lua-promise/assets/js/1.f431cc9e.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/10.62f75169.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/11.e6ef1863.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/12.9639e667.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/14.2fb7216e.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/15.c924e687.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/16.0363a397.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/17.b89347bd.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/18.9d79d831.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/19.4d87f771.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/2.1d61b953.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/20.4b2a6243.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/21.76836f9e.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/22.a1a335c7.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/23.cd6b0cfe.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/24.50f23036.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/25.6ba31e04.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/26.aaa06ffd.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/27.fc1d4723.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/28.3cd5c2bd.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/3.4fee984f.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/5.ceeb6115.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/7.c4167c59.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/9.788fa6c7.js">
    <link rel="stylesheet" href="/roblox-lua-promise/assets/css/0.styles.c44d6f8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/roblox-lua-promise/" class="home-link router-link-active"><!----> <span class="site-name">Roblox Lua Promise</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/roblox-lua-promise/lib/" class="nav-link router-link-active">API Reference</a></div><div class="nav-item"><a href="https://github.com/evaera/roblox-lua-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/roblox-lua-promise/lib/" class="nav-link router-link-active">API Reference</a></div><div class="nav-item"><a href="https://github.com/evaera/roblox-lua-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/roblox-lua-promise/lib/WhyUsePromises.html" class="sidebar-link">Why use Promises?</a></li><li><a href="/roblox-lua-promise/lib/Tour.html" class="sidebar-link">Tour of Promises</a></li><li><a href="/roblox-lua-promise/lib/Examples.html" class="active sidebar-link">Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/roblox-lua-promise/lib/Examples.html#chaining" class="sidebar-link">Chaining</a></li><li class="sidebar-sub-header"><a href="/roblox-lua-promise/lib/Examples.html#isingroup-wrapper" class="sidebar-link">IsInGroup wrapper</a></li><li class="sidebar-sub-header"><a href="/roblox-lua-promise/lib/Examples.html#tweenservice-wrapper" class="sidebar-link">TweenService wrapper</a></li><li class="sidebar-sub-header"><a href="/roblox-lua-promise/lib/Examples.html#cancellable-animation-sequence" class="sidebar-link">Cancellable animation sequence</a></li></ul></li><li><a href="/roblox-lua-promise/CHANGELOG.html" class="sidebar-link">Changelog</a></li><li><a href="/roblox-lua-promise/lib/" class="sidebar-link">Promise</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="examples"><a href="#examples" aria-hidden="true" class="header-anchor">#</a> Examples</h1> <h2 id="chaining"><a href="#chaining" aria-hidden="true" class="header-anchor">#</a> Chaining</h2> <p>Chain together multiple Promise-returning functions, and only handle a potential error once. If any function rejects in the chain, execution will jump down to <code>catch</code>.</p> <div class="language-lua extra-class"><pre class="language-lua"><code>	<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span>doSomethingElse<span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span>doSomethingOtherThanThat<span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span>doSomethingAgain<span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">catch</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span>
</code></pre></div><h2 id="isingroup-wrapper"><a href="#isingroup-wrapper" aria-hidden="true" class="header-anchor">#</a> IsInGroup wrapper</h2> <p>This function demonstrates how to convert a function that yields into a function that returns a Promise. (Assuming you don't want to use <a href="/roblox-lua-promise/lib/#promisify">Promise.promisify</a>)</p> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">isPlayerInGroup</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> groupId<span class="token punctuation">)</span>
	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span>player<span class="token punctuation">:</span><span class="token function">IsInGroup</span><span class="token punctuation">(</span>groupId<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre></div><h2 id="tweenservice-wrapper"><a href="#tweenservice-wrapper" aria-hidden="true" class="header-anchor">#</a> TweenService wrapper</h2> <p>This function demonstrates convert a Roblox API that uses events into a function that returns a Promise.</p> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">tween</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> tweenInfo<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> onCancel<span class="token punctuation">)</span>
			<span class="token keyword">local</span> tween <span class="token operator">=</span> TweenService<span class="token punctuation">:</span><span class="token function">Create</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> tweenInfo<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
			
			<span class="token keyword">if</span> <span class="token function">onCancel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				tween<span class="token punctuation">:</span><span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
			
			tween<span class="token punctuation">.</span>Completed<span class="token punctuation">:</span><span class="token function">Connect</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
			tween<span class="token punctuation">:</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">end</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h2 id="cancellable-animation-sequence"><a href="#cancellable-animation-sequence" aria-hidden="true" class="header-anchor">#</a> Cancellable animation sequence</h2> <p>The following is an example of an animation sequence which is composable and cancellable. If the sequence is cancelled, the animated part will instantly jump to the end position as if it had played all the way through.</p> <p>We use <a href="/roblox-lua-promise/lib/#donecall">Promise.doneCall</a>, which uses <code>done</code> internally, instead of <code>andThen</code> because we want the Promises to run even if the Promise is cancelled. We handle the case of the Promise being cancelled with the <code>onCancel</code> function.</p> <p>We take advantage of Promise chaining by returning Promises from the <code>done</code> handler functions. Because of this behavior, cancelling the final Promise in the chain will propagate up to the very top and cancel every single Promise you see here.</p> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">local</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>ReplicatedStorage<span class="token punctuation">.</span>Promise<span class="token punctuation">)</span>
<span class="token keyword">local</span> TweenService <span class="token operator">=</span> game<span class="token punctuation">:</span><span class="token function">GetService</span><span class="token punctuation">(</span><span class="token string">&quot;TweenService&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">local</span> sleep <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>wait<span class="token punctuation">)</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
	<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token keyword">do</span>
		obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">runTween</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> onCancel<span class="token punctuation">)</span>
		<span class="token keyword">local</span> tween <span class="token operator">=</span> TweenService<span class="token punctuation">:</span><span class="token function">Create</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> TweenInfo<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span>
		
		<span class="token keyword">if</span> <span class="token function">onCancel</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			tween<span class="token punctuation">:</span><span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
		<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
		
		tween<span class="token punctuation">.</span>Completed<span class="token punctuation">:</span><span class="token function">Connect</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
		tween<span class="token punctuation">:</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">runAnimation</span><span class="token punctuation">(</span>part<span class="token punctuation">,</span> intensity<span class="token punctuation">)</span>
	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>sleep<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>runTween<span class="token punctuation">,</span> part<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			Reflectance <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> intensity
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>runTween<span class="token punctuation">,</span> part<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			CFrame <span class="token operator">=</span> CFrame<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span>Position<span class="token punctuation">)</span> <span class="token operator">*</span>
				CFrame<span class="token punctuation">.</span><span class="token function">Angles</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">rad</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">*</span> intensity<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>runTween<span class="token punctuation">,</span> part<span class="token punctuation">,</span> <span class="token punctuation">{</span>
			Size <span class="token operator">=</span> <span class="token punctuation">(</span>
				Vector3<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> intensity
			<span class="token punctuation">)</span> <span class="token operator">+</span> Vector3<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> animation <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Begin Promise chain</span>
	<span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>runAnimation<span class="token punctuation">,</span> workspace<span class="token punctuation">.</span>Part<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>sleep<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">:</span><span class="token function">doneCall</span><span class="token punctuation">(</span>runAnimation<span class="token punctuation">,</span> workspace<span class="token punctuation">.</span>Part<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">:</span><span class="token function">catch</span><span class="token punctuation">(</span>warn<span class="token punctuation">)</span>

<span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
animation<span class="token punctuation">:</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Remove this line to see the full animation</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/roblox-lua-promise/lib/Tour.html" class="prev">
          Tour of Promises
        </a></span> <span class="next"><a href="/roblox-lua-promise/CHANGELOG.html">
          Changelog
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/roblox-lua-promise/assets/js/app.11759dc5.js" defer></script><script src="/roblox-lua-promise/assets/js/6.4e8b591d.js" defer></script><script src="/roblox-lua-promise/assets/js/13.ceb2ce08.js" defer></script><script src="/roblox-lua-promise/assets/js/8.4fdf1a46.js" defer></script>
  </body>
</html>
